var P=Object.defineProperty;var V=(r,e,t)=>e in r?P(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var s=(r,e,t)=>(V(r,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function t(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(a){if(a.ep)return;a.ep=!0;const c=t(a);fetch(a.href,c)}})();const D="_wrapper_1mq7f_50",I="_btn-box_1mq7f_61",M="_garage-btn_1mq7f_70",A="_winners-btn_1mq7f_71",y={wrapper:D,"btn-box":"_btn-box_1mq7f_61",btnBox:I,"garage-btn":"_garage-btn_1mq7f_70",garageBtn:M,"winners-btn":"_winners-btn_1mq7f_71",winnersBtn:A};class o{constructor(e){s(this,"element");s(this,"children",[]);s(this,"handlers",[]);this.element=document.createElement(e.tag||"div"),this.addClasses(e.classNames),e.text!==null&&this.setTextContent(e.text),this.children=[]}getElement(){return this.element}getChildren(){return this.children}addClasses(e=[]){e.map(t=>this.element.classList.add(t))}setTextContent(e=""){this.element.textContent=e}addClass(e){this.element.classList.add(e)}toggleClass(e){this.element.classList.toggle(e)}removeClass(e){this.element.classList.remove(e)}append(...e){e.forEach(t=>{t instanceof o&&(this.element.append(t.element),this.children.push(t))})}insertBefore(e,t,n){this.element.insertBefore(e.element,t.element),this.children[n]=e}attr(e,t){return t?(this.element.setAttribute(e,t),this):this.element.getAttribute(e)}removeAttr(e){this.element.removeAttribute(e)}css(e,t){this.element.style.setProperty(e,t)}findAll(e){return[...this.element.querySelectorAll(e)]}closest(e){return this.element.closest(e)}on(e,t){this.element.addEventListener(e,t),this.handlers.push({eventType:e,callback:t})}off(e,t){this.element.removeEventListener(e,t)}html(e){this.element.innerHTML=e}destroyChildren(){this.children.length>0&&(this.children.forEach(e=>{e.destroy()}),this.children.length=0)}destroy(){this.destroyChildren(),this.element.remove(),this.deleteHandlers()}deleteHandlers(){this.handlers.forEach(e=>{this.off(e.eventType,e.callback)})}}class d extends o{constructor(t){super({tag:"button",...t});s(this,"disable",()=>{this.element.disabled=!0});s(this,"enable",()=>{this.element.disabled=!1});t.type&&this.attr("type",t.type),t.callback&&this.on("click",t.callback),t.disabled&&this.disable()}}const F="_garage-wrapper_1t7wg_38",O="_first-title_1t7wg_48",R="_top-block_1t7wg_60",L="_buttons-block_1t7wg_71",G="_race-btn_1t7wg_80",H="_reset-btn_1t7wg_81",j="_generate-btn_1t7wg_109",U="_garage-title_1t7wg_136",q="_garage-list_1t7wg_142",X="_pagination_1t7wg_146",J="_prev-btn_1t7wg_154",Q="_next-btn_1t7wg_155",z="_page-title_1t7wg_197",w={"garage-wrapper":"_garage-wrapper_1t7wg_38",garageWrapper:F,"first-title":"_first-title_1t7wg_48",firstTitle:O,"top-block":"_top-block_1t7wg_60",topBlock:R,"buttons-block":"_buttons-block_1t7wg_71",buttonsBlock:L,"race-btn":"_race-btn_1t7wg_80",raceBtn:G,"reset-btn":"_reset-btn_1t7wg_81",resetBtn:H,"generate-btn":"_generate-btn_1t7wg_109",generateBtn:j,"garage-title":"_garage-title_1t7wg_136",garageTitle:U,"garage-list":"_garage-list_1t7wg_142",garageList:q,pagination:X,"prev-btn":"_prev-btn_1t7wg_154",prevBtn:J,"next-btn":"_next-btn_1t7wg_155",nextBtn:Q,"page-title":"_page-title_1t7wg_197",pageTitle:z},K="_car-block_1v59m_38",Y="_car-img_1v59m_47",Z="_flag-icon_1v59m_55",tt="_car-name_1v59m_67",et="_buttons-box_1v59m_71",nt="_select-btn_1v59m_77",st="_remove-btn_1v59m_78",rt="_controls-box_1v59m_117",at="_start-btn_1v59m_124",it="_stop-btn_1v59m_125",ot="_car-broken_1v59m_169",f={"car-block":"_car-block_1v59m_38",carBlock:K,"car-img":"_car-img_1v59m_47",carImg:Y,"flag-icon":"_flag-icon_1v59m_55",flagIcon:Z,"car-name":"_car-name_1v59m_67",carName:tt,"buttons-box":"_buttons-box_1v59m_71",buttonsBox:et,"select-btn":"_select-btn_1v59m_77",selectBtn:nt,"remove-btn":"_remove-btn_1v59m_78",removeBtn:st,"controls-box":"_controls-box_1v59m_117",controlsBox:rt,"start-btn":"_start-btn_1v59m_124",startBtn:at,"stop-btn":"_stop-btn_1v59m_125",stopBtn:it,"car-broken":"_car-broken_1v59m_169",carBroken:ot},S=r=>`<svg fill="transparent" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path d="M8 17H16M8 17C8 18.1046 7.10457 19 6 19C4.89543 19 4 18.1046 4 17M8 17C8 15.8954 7.10457 15 6 15C4.89543 15 4 15.8954 4 17M16 17C16 18.1046 16.8954 19 18 19C19.1046 19 20 18.1046 20 17M16 17C16 15.8954 16.8954 15 18 15C19.1046 15 20 15.8954 20 17M10 5V11M4 11L4.33152 9.01088C4.56901 7.58593 4.68776 6.87345 5.0433 6.3388C5.35671 5.8675 5.79705 5.49447 6.31346 5.26281C6.8993 5 7.6216 5 9.06621 5H12.4311C13.3703 5 13.8399 5 14.2662 5.12945C14.6436 5.24406 14.9946 5.43194 15.2993 5.68236C15.6435 5.96523 15.904 6.35597 16.425 7.13744L19 11M4 17H3.6C3.03995 17 2.75992 17 2.54601 16.891C2.35785 16.7951 2.20487 16.6422 2.10899 16.454C2 16.2401 2 15.9601 2 15.4V14.2C2 13.0799 2 12.5198 2.21799 12.092C2.40973 11.7157 2.71569 11.4097 3.09202 11.218C3.51984 11 4.0799 11 5.2 11H17.2C17.9432 11 18.3148 11 18.6257 11.0492C20.3373 11.3203 21.6797 12.6627 21.9508 14.3743C22 14.6852 22 15.0568 22 15.8C22 15.9858 22 16.0787 21.9877 16.1564C21.9199 16.5843 21.5843 16.9199 21.1564 16.9877C21.0787 17 20.9858 17 20.8 17H20" stroke=${r} stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>`;var C=(r=>(r.none="",r.wins="wins",r.time="time",r))(C||{}),u=(r=>(r.none="",r.up="ASC",r.down="DESC",r))(u||{});class ct{constructor(){s(this,"listeners",{})}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(n=>n!==t))}emit(e,...t){const n=this.listeners[e];n&&n.forEach(a=>{a(...t)})}}const m=new ct,W=7,B=10,lt=100,mt="#000000";class ht{constructor(){s(this,"race",!1);s(this,"winner",0);s(this,"allCarsCount",0);s(this,"allWinnersCount",0);s(this,"currPage",1);s(this,"winnersPage",1);s(this,"prevBtn",!1);s(this,"nextBtn",!0);s(this,"prevWinners",!1);s(this,"nextWinners",!1);s(this,"promisesCount",0);s(this,"sort",C.none);s(this,"order",u.none);s(this,"formsState",[]);s(this,"carsMap",new Map);s(this,"addCarToState",e=>{const t={...e,status:"stop",wins:0};this.carsMap.set(e.id,t),m.emit("addNewCar",t)});s(this,"updateCarInState",e=>{this.carsMap.set(e.id,e),m.emit("updateCar",e)})}resetRace(){this.race=!1,this.winner=0,this.promisesCount=0}setRaceState(e){this.race=e}setWinner(e){if(this.winner=e,e===0)return;const t=this.carsMap.get(e);m.emit("showWinner",t)}setWinnerData(e){const t=this.carsMap.get(e.id);if(!t)throw new Error("carData is undefined");const n=e.time*1e3;t.wins=e.wins+1,t.duration=n<t.duration?n:t.duration}getWinnerData(e){const t=this.carsMap.get(e);if(!t)throw new Error("carData is undefined");const n=+(t.duration/1e3).toFixed(2);return{wins:t.wins,time:n}}getCarData(e){return this.carsMap.get(e)}getSortValue(){return this.sort}getOrderValue(){return this.order}getFisrtWinnerData(e){const t=this.carsMap.get(e);if(!t)throw new Error("carData is undefined");const n=+(t.duration/1e3).toFixed(2);return{id:t.id,wins:1,time:n}}addCarsToState(e){m.emit("destroyGarageView"),this.carsMap.clear(),e.forEach(t=>{this.addCarToState(t)})}updateGarageData(e,t,n){this.addCarsToState(e),this.updateAllCarsCount(t),this.updatePageNumber(n)}updateAllCarsCount(e){this.allCarsCount=e,m.emit("updateCount",e),console.log("??????updateCount")}getCurrentPage(){return this.currPage}updatePageNumber(e){this.currPage=e,this.currPage===1?this.prevBtn=!1:this.prevBtn=!0,Math.ceil(this.allCarsCount/W)===this.currPage?this.nextBtn=!1:this.nextBtn=!0,m.emit("updatePage",e,this.prevBtn,this.nextBtn)}setCarStatusDrive(e,t){const n=t.distance/t.velocity,a=this.carsMap.get(e);if(!a)throw new Error("carData is undefined");a.status="drive",a.duration=n,m.emit("startMoving",n,e)}setCarStatusBroken(e){const t=this.carsMap.get(e);if(!t)throw new Error("carData is undefined");t.status="broken",m.emit("stopMoving",e)}setCarStatusStop(e){const t=this.carsMap.get(e);if(!t)throw new Error("carData is undefined");t.status="stop",console.log("car stopped"),m.emit("toStart",e)}getCarStatus(e){const t=this.carsMap.get(e);if(!t)throw new Error("cardData is undefined");const{status:n}=t;return n}updatePromisesCount(){i.promisesCount+=1,console.log("count=",i.promisesCount),i.promisesCount===this.carsMap.size&&(m.emit("finishRace"),i.promisesCount=0)}setWinners(e,t){const n=e.map((a,c)=>({id:a.id,wins:a.wins,time:a.time,color:t[c].color,name:t[c].name}));console.log(n),m.emit("updateWinnersView",n,this.winnersPage)}setWinnersCount(e){this.allWinnersCount=e,m.emit("updateWinnersCount",e)}setWinnersPage(e){this.winnersPage=e,this.winnersPage===1?this.prevWinners=!1:this.prevWinners=!0,Math.ceil(this.allWinnersCount/B)===this.winnersPage?this.nextWinners=!1:this.nextWinners=!0,m.emit("updateWinnersPage",e,this.prevWinners,this.nextWinners)}setOrderAndSortState(e,t){this.sort=e,this.order=t}saveGarageState(e){this.formsState=e,console.log("formsState",this.formsState)}getGarageFormsState(){return this.formsState}}const i=new ht,g="http://127.0.0.1:3000",p={garage:"/garage",winners:"/winners",engine:"/engine"};function ut(r=[]){const e=r.length>0?`?${r.map(t=>`${t.key}=${t.value}`).join("&")}`:"";return console.log("string=",e),e}async function b(r){console.log("GETCARS");try{const e=await fetch(`${g}${p.garage}?_page=${r}&_limit=${W}}`),t=await e.json();if(t.length===0&&i.currPage>1)i.currPage-=1,b(i.currPage);else{const n=Number(e.headers.get("X-Total-Count"));i.updateGarageData(t,n,r),console.log("UPDATEDATA")}}catch(e){e instanceof Error&&console.error("Error:",e.message)}}async function dt(r){try{const t=await(await fetch(`${g}${p.garage}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json();console.log("newcar=",t),b(i.currPage)}catch(e){e instanceof Error&&console.error("Error:",e.message)}}async function gt(r,e){try{const n=await(await fetch(`${g}${p.garage}/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();i.updateCarInState(n)}catch(t){t instanceof Error&&console.error("Error:",t.message)}}async function pt(r){fetch(`${g}${p.winners}/${r}`,{method:"DELETE"}).catch(e=>{e instanceof Error&&console.error("Error:",e.message)})}function wt(r){fetch(`${g}${p.garage}/${r}`,{method:"DELETE"}).then(()=>{b(i.currPage)}).then(()=>{pt(r)}).catch(e=>{e instanceof Error&&console.error("Error:",e.message)})}function ft(r){fetch(`${g}${p.winners}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i.getFisrtWinnerData(r))}).then(e=>{e.status===500&&Nt(r)}).catch(e=>{e instanceof Error&&console.error("Error:",e.message)})}function _t(r,e,t){fetch(`${g}${p.engine}?id=${r}&status=${e}`,{method:"PATCH",signal:t.signal}).then(n=>{i.updatePromisesCount(),n.status===500&&i.setCarStatusBroken(r),n.status===200&&!i.winner&&i.race&&(i.setRaceState(!1),i.setWinner(r),console.log("WINNER ID=",r),ft(r))}).catch(n=>{n instanceof Error&&console.log(n.message)})}async function Ct(r,e,t){try{const a=await(await fetch(`${g}${p.engine}?id=${r}&status=${e}`,{method:"PATCH"})).json();_t(r,"drive",t),i.setCarStatusDrive(r,a)}catch(n){n instanceof Error&&console.error("Error:",n.message)}}async function bt(r,e){try{await fetch(`${g}${p.engine}?id=${r}&status=stopped`,{method:"PATCH"}),e.abort(),i.setCarStatusStop(r)}catch(t){t instanceof Error&&console.error("Error:",t.message)}}async function Bt(r){try{const e=r.map(t=>fetch(`${g}${p.garage}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}));await Promise.all(e),b(i.currPage)}catch(e){e instanceof Error&&console.error("Error:",e.message)}}function vt(r,e){console.log("params=",r),fetch(`${g}${p.winners}${ut(r)}`,{method:"GET"}).then(t=>{console.log("response=",t);const n=Number(t.headers.get("X-Total-Count"));return console.log("winnerscount",n),i.setWinnersCount(n),i.setWinnersPage(e),t.json()}).then(t=>{const n=t.map(a=>fetch(`${g}${p.garage}/${a.id}`,{method:"GET"}).then(c=>c.json()));Promise.all(n).then(a=>{i.setWinners(t,a)})}).catch(t=>{t instanceof Error&&console.error("Error:",t.message)})}function xt(r){fetch(`${g}${p.winners}/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i.getWinnerData(r))}).then(e=>e.json()).then(e=>{console.log("winner",e)}).catch(e=>{e instanceof Error&&console.error("Error:",e.message)})}function Nt(r){fetch(`${g}${p.winners}/${r}`,{method:"GET"}).then(e=>e.json()).then(e=>{i.setWinnerData(e)}).then(()=>{xt(r)}).catch(e=>{e instanceof Error&&console.error("Error:",e.message)})}function yt(r){const e=r.getBoundingClientRect(),t=e.width,a=window.innerWidth-t-40;console.log("right=",a);const c=e.left;return a-c}function k(r){return typeof r=="object"&&r!==null&&"id"in r}class Tt extends o{constructor(t){super({tag:"div",classNames:[f.carBlock]});s(this,"fetchController",new AbortController);s(this,"animationId");s(this,"selectBtn",new d({classNames:[f.selectBtn],text:"Select"}));s(this,"removeBtn",new d({classNames:[f.removeBtn],text:"Remove"}));s(this,"startBtn",new d({classNames:[f.startBtn],text:"А"}));s(this,"stopBtn",new d({classNames:[f.stopBtn],text:"В",disabled:!0}));s(this,"carImg",new o({tag:"div",classNames:[f.carImg]}));s(this,"carName",new o({tag:"div",classNames:[f.carName]}));s(this,"id",0);s(this,"clickOnRemoveBtn",()=>{wt(this.id)});s(this,"clickOnStartBtn",()=>{console.log("status=",i.getCarStatus(this.id)),this.fetchController=new AbortController,Ct(this.id,"started",this.fetchController),this.startBtn.disable()});s(this,"clickOnStopBtn",()=>{const t=i.getCarStatus(this.id);(t==="drive"||t==="broken")&&(bt(this.id,this.fetchController),this.carImg.removeClass(f.carBroken)),this.stopBtn.disable()});s(this,"moveCarToStart",t=>{if(typeof t!="number")throw new Error("id is not number");this.id===t&&(console.log("car move to start"),this.stopMoving(this.id),this.carImg.css("transform","translateX(0px)"),this.startBtn.enable())});s(this,"clickOnSelectBtn",()=>{m.emit("enableUpdateForm",this.id)});s(this,"updateCarView",t=>{if(!k(t))throw new Error("argument is not type CarData");this.element.id===String(t.id)&&(this.carName.setTextContent(t.name),this.carImg.html(S(t.color)))});s(this,"startMoving",(t,n)=>{if(typeof n!="number")throw new Error("id is not number");if(this.id!==n)return;if(typeof t!="number")throw new Error("duration is not number");this.stopBtn.enable();const c=yt(this.carImg.element)/t,h=0;let _=0;const v=x=>{_||(_=x);const N=x-_,E=h+c*N;this.carImg.css("transform",`translateX(${E}px)`),N<t&&(this.animationId=requestAnimationFrame(v))};requestAnimationFrame(v)});s(this,"stopMoving",t=>{if(typeof t!="number")throw new Error("id is not number");if(this.id!==t)return;if(!this.animationId)throw new Error("animationid is undefined");i.getCarStatus(this.id)==="broken"&&this.carImg.addClass(f.carBroken),cancelAnimationFrame(this.animationId)});this.id=t.id,this.element.id=t.id.toString(),this.createView(t),this.removeBtn.on("click",this.clickOnRemoveBtn),this.startBtn.on("click",this.clickOnStartBtn),this.stopBtn.on("click",this.clickOnStopBtn),this.selectBtn.on("click",this.clickOnSelectBtn),m.on("startMoving",this.startMoving),m.on("stopMoving",this.stopMoving),m.on("updateCar",this.updateCarView),m.on("toStart",this.moveCarToStart)}createView(t){this.carName.setTextContent(t.name);const n=new o({tag:"div",classNames:[f.buttonsBox]}),a=new o({tag:"div",classNames:[f.controlsBox]}),c=new o({tag:"div",classNames:[f.flagIcon]});this.carImg.html(S(t.color)),n.append(this.selectBtn,this.removeBtn),a.append(this.startBtn,this.stopBtn),this.append(this.carName,n,a,this.carImg,c)}}const Et="_form-box_vu432_38",St="_input-name_vu432_48",kt="_input-color_vu432_53",Wt="_submit-btn_vu432_63",T={"form-box":"_form-box_vu432_38",formBox:Et,"input-name":"_input-name_vu432_48",inputName:St,"input-color":"_input-color_vu432_53",inputColor:kt,"submit-btn":"_submit-btn_vu432_63",submitBtn:Wt};class $ extends o{constructor(t){super({tag:"form",classNames:[T.formBox]});s(this,"inputName",new o({tag:"input",classNames:[T.inputName]}));s(this,"inputColor",new o({tag:"input",classNames:[T.inputColor]}));s(this,"submitBtn",new d({classNames:[T.submitBtn]}));s(this,"disabled",!1);s(this,"currentId",0);s(this,"disable",()=>{this.disabled=!0,this.children.forEach(t=>{t.attr("disabled","true")})});s(this,"enable",()=>{this.disabled=!1,this.children.forEach(t=>{t.removeAttr("disabled")})});this.formName=t,this.configureView()}configureView(){this.inputName.attr("type","text"),this.inputColor.attr("type","color"),this.append(this.inputName,this.inputColor,this.submitBtn),this.children.forEach(t=>{t.attr("required","true")})}resetForm(){this.inputName.element.value="",this.inputColor.element.value=mt}getInputValue(t){return t.getElement().value}getInputsValues(){const t=this.inputName.element.value,n=this.inputColor.element.value,a=this.currentId;return{name:t,color:n,id:a}}updateView(t){console.log("formstate",t),t.disabled?this.disable():(this.enable(),this.currentId=t.currentId,this.inputName.element.value=t.nameInput,this.inputColor.element.value=t.colorInput)}}let $t=class extends ${constructor(t){super(t);s(this,"onSubmitHandler",t=>{t.preventDefault();const n={name:this.getInputValue(this.inputName),color:this.getInputValue(this.inputColor)};dt(n),this.resetForm()});this.addClass("create-form"),this.submitBtn.setTextContent("Create"),this.on("submit",this.onSubmitHandler)}};class Pt extends ${constructor(t){super(t);s(this,"enableForm",t=>{if(typeof t!="number")throw new Error("id is not string");this.enable(),this.inputName.element.focus(),this.currentId=t;const n=i.getCarData(t);if(!n)throw new Error("carData is undefined");const{name:a,color:c}=n;this.inputName.element.value=a,this.inputColor.element.value=c});s(this,"onSubmitHandler",t=>{t.preventDefault();const n={name:this.getInputValue(this.inputName),color:this.getInputValue(this.inputColor)};gt(this.currentId,n),this.resetForm(),this.disable(),this.currentId=0});this.addClass("update-form"),this.disable(),this.submitBtn.setTextContent("Update"),m.on("enableUpdateForm",this.enableForm),this.on("submit",this.onSubmitHandler)}}const Vt=[{Toyota:["Corolla","Camry","Rav4","Prius","Highlander","Tacoma","Tundra","Sienna","Yaris","4Runner"]},{Honda:["Civic","Accord","CR-V","Pilot","Odyssey","Fit","Ridgeline","HR-V","Insight","Passport"]},{" Ford":["F-150","Escape","Explorer","Focus","Edge","Mustang","Ranger","Fusion","Expedition","EcoSport"]},{Chevrolet:["Silverado","Equinox","Malibu","Traverse","Tahoe","Camaro","Colorado","Blazer","Suburban","Corvette"]},{" Volkswagen":["Jetta","Passat","Tiguan","Atlas","Golf","Arteon","ID.4","Taos","Atlas Cross Sport","Touareg"]},{"Mercedes-Benz":["C-Class","E-Class","S-Class","GLC","GLE","GLA","G-Class","A-Class","CLA","GLB"]},{" BMW":["3 Series","5 Series","X3","X5","X1","7 Series","X7","2 Series","4 Series","8 Series"]},{" Audi":["A4","Q5","A3","Q7","Q3","A6","A5","Q8","A7","e-tron"]},{Hyundai:["Elantra","Sonata","Tucson","Santa Fe","Kona","Palisade","Venue","Accent","Veloster","Ioniq"]},{Kia:["Sorento","Sportage","Telluride","Soul","Forte","Optima","Stinger","Rio","Cadenza","K5"]}];function Dt(r){const e=Math.floor(Math.random()*r.length),t=r[e],n=Object.keys(t)[0],a=t[n],c=Math.floor(Math.random()*a.length),h=a[c];return`${n} ${h}`}function It(){const r="0123456789ABCDEF";let e="#";for(let t=0;t<6;t+=1)e+=r[Math.floor(Math.random()*16)];return e}function Mt(){const r=[];for(let e=0;e<lt;e+=1){const t={name:Dt(Vt),color:It()};r.push(t)}return r}class At extends o{constructor(t){super({tag:"div",classNames:[w.garageWrapper]});s(this,"createForm",new $t("createForm"));s(this,"updateForm",new Pt("updateForm"));s(this,"forms",[this.createForm,this.updateForm]);s(this,"raceBtn",new d({classNames:[w.raceBtn],text:"Race"}));s(this,"resetBtn",new d({classNames:[w.resetBtn],text:"Reset",disabled:!0}));s(this,"generateBtn",new d({classNames:[w.generateBtn],text:"Generate Cars"}));s(this,"garageTitle",new o({tag:"p",classNames:[w.garageTitle]}));s(this,"pageTitle",new o({tag:"p",classNames:[w.pageTitle]}));s(this,"firstTitle",new o({tag:"p",classNames:[w.firstTitle]}));s(this,"garageList",new o({tag:"div",classNames:[w.garageList]}));s(this,"prevBtn",new d({classNames:[w.prevBtn]}));s(this,"nextBtn",new d({classNames:[w.nextBtn]}));s(this,"cars",[]);s(this,"updateCarsCount",t=>{if(typeof t!="number")throw new Error("count is not number");this.garageTitle.setTextContent(`Garage (${t})`)});s(this,"updatePages",(t,n,a)=>{if(typeof t!="number")throw new Error("count is not number");if(typeof n!="boolean"||typeof a!="boolean")throw new Error("state of pagination is not boolean");this.pageTitle.setTextContent(`${t}`),this.prevBtn.element.disabled=!n,this.nextBtn.element.disabled=!a});s(this,"addNewCarToView",t=>{if(!k(t))throw new Error("argument is not type CarData");const n=new Tt(t);this.cars.push(n),this.garageList.append(n)});s(this,"destroyGarage",()=>{this.cars=[],this.garageList.children&&this.garageList.destroyChildren()});s(this,"onClickGenerateBtn",()=>{const t=Mt();Bt(t)});s(this,"onClickPrevBtn",()=>{b(i.currPage-1)});s(this,"onClickNextBtn",()=>{b(i.currPage+1)});s(this,"onClickRaceBtn",()=>{i.setRaceState(!0),this.cars.forEach(t=>{t.clickOnStartBtn()}),this.resetBtn.disable(),this.raceBtn.disable(),this.winnersBtn.disable()});s(this,"onClickResetBtn",()=>{i.setRaceState(!1),i.setWinner(0),this.cars.forEach(t=>{t.clickOnStopBtn()}),this.firstTitle.setTextContent(""),this.raceBtn.enable(),this.resetBtn.disable()});s(this,"showWinner",t=>{if(!k(t))throw new Error("argument is not type CarData");const n=(t.duration/1e3).toFixed(2);this.firstTitle.setTextContent(`${t.name} went first in ${n}s`),this.resetBtn.enable()});s(this,"enableWinnersBtn",()=>{this.winnersBtn.enable()});this.winnersBtn=t,this.createView(),b(i.currPage),this.updateFormsView(),m.on("addNewCar",this.addNewCarToView),m.on("destroyGarageView",this.destroyGarage),m.on("updateCount",this.updateCarsCount),m.on("updatePage",this.updatePages),m.on("showWinner",this.showWinner),m.on("finishRace",this.enableWinnersBtn),this.generateBtn.on("click",this.onClickGenerateBtn),this.prevBtn.on("click",this.onClickPrevBtn),this.nextBtn.on("click",this.onClickNextBtn),this.raceBtn.on("click",this.onClickRaceBtn),this.resetBtn.on("click",this.onClickResetBtn)}createView(){const t=new o({tag:"div",classNames:[w.topBlock]}),n=new o({tag:"div",classNames:[w.buttonsBlock]});n.append(this.raceBtn,this.resetBtn,this.generateBtn),t.append(this.createForm,this.updateForm,n,this.garageTitle);const a=new o({tag:"div",classNames:[w.pagination]});a.append(this.prevBtn,this.pageTitle,this.nextBtn),this.append(this.firstTitle,t,this.garageList,a)}updateFormsView(){const t=i.getGarageFormsState();t.length!==0&&this.forms.forEach(n=>{const a=t.find(c=>c.formName===n.formName);if(!a)throw new Error("formstate is undefined");n.updateView(a)})}getFormsState(){const t=[];return this.forms.forEach(n=>{const{name:a,color:c,id:h}=n.getInputsValues(),_={formName:n.formName,disabled:n.disabled,nameInput:a,colorInput:c,currentId:h};t.push(_)}),t}}const Ft="_winners-wrapper_175e1_38",Ot="_winners-title_175e1_47",Rt="_winners-table_175e1_54",Lt="_table-header_175e1_59",Gt="_number-column_175e1_69",Ht="_carview-column_175e1_73",jt="_carname-column_175e1_77",Ut="_wins-column_175e1_81",qt="_arrow-up_175e1_88",Xt="_arrow-down_175e1_103",Jt="_time-column_175e1_118",Qt="_icon-cell_175e1_125",zt="_pagination_175e1_129",Kt="_prev-btn_175e1_137",Yt="_next-btn_175e1_138",Zt="_page-title_175e1_180",l={"winners-wrapper":"_winners-wrapper_175e1_38",winnersWrapper:Ft,"winners-title":"_winners-title_175e1_47",winnersTitle:Ot,"winners-table":"_winners-table_175e1_54",winnersTable:Rt,"table-header":"_table-header_175e1_59",tableHeader:Lt,"number-column":"_number-column_175e1_69",numberColumn:Gt,"carview-column":"_carview-column_175e1_73",carviewColumn:Ht,"carname-column":"_carname-column_175e1_77",carnameColumn:jt,"wins-column":"_wins-column_175e1_81",winsColumn:Ut,"arrow-up":"_arrow-up_175e1_88",arrowUp:qt,"arrow-down":"_arrow-down_175e1_103",arrowDown:Xt,"time-column":"_time-column_175e1_118",timeColumn:Jt,"icon-cell":"_icon-cell_175e1_125",iconCell:Qt,pagination:zt,"prev-btn":"_prev-btn_175e1_137",prevBtn:Kt,"next-btn":"_next-btn_175e1_138",nextBtn:Yt,"page-title":"_page-title_175e1_180",pageTitle:Zt};class te extends o{constructor(){super({tag:"div",classNames:[l.winnersWrapper]});s(this,"winnersTitle",new o({tag:"p",classNames:[l.winnersTitle]}));s(this,"pageTitle",new o({tag:"p",classNames:[l.pageTitle]}));s(this,"tableBody",new o({tag:"tbody",classNames:[l.tableBody]}));s(this,"winsColumn",new o({tag:"th",classNames:[l.winsColumn],text:"Wins"}));s(this,"timeColumn",new o({tag:"th",classNames:[l.timeColumn],text:"Best time,s"}));s(this,"prevBtn",new d({classNames:[l.prevBtn]}));s(this,"nextBtn",new d({classNames:[l.nextBtn]}));s(this,"updateTableView",(t,n)=>{if(!Array.isArray(t))throw new Error("argument is not array");if(typeof n!="number")throw new Error("page is not number");console.log("updateview"),this.tableBody.children&&this.tableBody.destroyChildren(),t.forEach((a,c)=>{const h=new o({tag:"tr",classNames:["winner-row"]}),_=new o({tag:"td",classNames:["numb-cell"],text:`${c+1+(n-1)*10}`}),v=new o({tag:"td",classNames:[l.iconCell]});v.html(S(a.color));const x=new o({tag:"td",classNames:["name-cell"],text:a.name}),N=new o({tag:"td",classNames:["wins-cell"],text:`${a.wins}`}),E=new o({tag:"td",classNames:["time-cell"],text:`${a.time}`});h.append(_,v,x,N,E),this.tableBody.append(h)})});s(this,"getWinnersData",t=>{const n=Object.entries(t).map(([a,c])=>({key:`_${a}`,value:`${c}`})).filter(a=>a.value!=="");console.log("params!!!!! =",n,t.page),vt(n,t.page)});s(this,"updateWinnersTitle",t=>{this.winnersTitle.setTextContent(`Winners (${t})`)});s(this,"updateWinnersPage",(t,n,a)=>{if(typeof t!="number")throw new Error("count is not number");if(typeof n!="boolean"||typeof a!="boolean")throw new Error("state of pagination is not boolean");this.pageTitle.setTextContent(`${t}`),this.prevBtn.element.disabled=!n,this.nextBtn.element.disabled=!a});s(this,"onClickPrevBtn",()=>{this.getWinnersData({page:i.winnersPage-1,limit:B,sort:i.sort,order:i.order})});s(this,"onClickNextBtn",()=>{this.getWinnersData({page:i.winnersPage+1,limit:B,sort:i.sort,order:i.order})});s(this,"onClickWinsSort",()=>{const t=i.order===u.up?u.down:u.up;console.log("order1=",t),this.getWinnersData({page:i.winnersPage,limit:B,sort:C.wins,order:t});const n=t===u.up?l.arrowUp:l.arrowDown;let a="";i.order&&(a=i.order===u.up?l.arrowUp:l.arrowDown,this.winsColumn.removeClass(a)),this.winsColumn.addClass(n),this.timeColumn.removeClass(l.arrowUp),this.timeColumn.removeClass(l.arrowDown),i.setOrderAndSortState(C.wins,t)});s(this,"onClickTimeSort",()=>{const t=i.order===u.up?u.down:u.up;this.getWinnersData({page:i.winnersPage,limit:B,sort:C.time,order:t});const n=t===u.up?l.arrowUp:l.arrowDown;let a="";i.order&&(a=i.order===u.up?l.arrowUp:l.arrowDown,this.timeColumn.removeClass(a)),this.timeColumn.addClass(n),this.winsColumn.removeClass(l.arrowUp),this.winsColumn.removeClass(l.arrowDown),i.setOrderAndSortState(C.time,t)});this.createView(),this.getWinnersData({page:i.winnersPage,limit:B,sort:i.sort,order:i.order}),m.on("updateWinnersView",this.updateTableView),m.on("updateWinnersCount",this.updateWinnersTitle),m.on("updateWinnersPage",this.updateWinnersPage),this.prevBtn.on("click",this.onClickPrevBtn),this.nextBtn.on("click",this.onClickNextBtn),this.winsColumn.on("click",this.onClickWinsSort),this.timeColumn.on("click",this.onClickTimeSort)}createView(){const t=new o({tag:"table",classNames:[l.winnersTable]}),n=new o({tag:"tr",classNames:[l.tableHeader]}),a=new o({tag:"th",classNames:[l.numberColumn],text:"N"}),c=new o({tag:"th",classNames:[l.carviewColumn],text:"Car"}),h=new o({tag:"th",classNames:[l.carnameColumn],text:"Name"});n.append(a,c,h,this.winsColumn,this.timeColumn),t.append(n,this.tableBody);const _=new o({tag:"div",classNames:[l.pagination]});_.append(this.prevBtn,this.pageTitle,this.nextBtn),this.append(this.winnersTitle,t,_),this.checkSortedTable()}checkSortedTable(){const t=i.getSortValue(),n=i.getOrderValue();console.log("order2=",n),t===C.wins?n===u.up?this.winsColumn.addClass(l.arrowUp):this.winsColumn.addClass(l.arrowDown):t===C.time&&(n===u.up?this.timeColumn.addClass(l.arrowUp):this.timeColumn.addClass(l.arrowDown))}}class ee{constructor(){s(this,"root",new o({tag:"div",classNames:[y.wrapper]}));s(this,"garageBtn",new d({classNames:[y.garageBtn],text:"to Garage"}));s(this,"winnersBtn",new d({classNames:[y.winnersBtn],text:"to Winners"}));s(this,"garageView");s(this,"winnersView");s(this,"createGarageView",()=>{this.winnersView&&this.winnersView.destroy(),this.garageView=new At(this.winnersBtn),this.root.append(this.garageView),this.garageBtn.disable(),this.winnersBtn.enable()});s(this,"createWinnersView",()=>{if(!this.garageView)throw new Error("garageview is undefined");i.saveGarageState(this.garageView.getFormsState()),this.garageView.destroy(),this.winnersView=new te,this.root.append(this.winnersView),this.winnersBtn.disable(),this.garageBtn.enable(),i.resetRace()});this.garageBtn.on("click",this.createGarageView),this.winnersBtn.on("click",this.createWinnersView)}start(){this.createView()}createView(){const e=new o({tag:"div",classNames:[y.btnBox]});e.append(this.garageBtn,this.winnersBtn),this.root.append(e),document.body.append(this.root.getElement()),this.createGarageView()}}const ne=new ee;ne.start();
//# sourceMappingURL=index-PNdRqiLe.js.map
